# Vector Map Style Profiler üó∫Ô∏èüìèüé®

This repository contains tools for profiling the performance of various vector map styles using [MapLibre GL](https://github.com/maplibre/maplibre-gl-js).

## Online Profiler Tool

This is a tool to test the load and render times of [MapLibre styles](https://maplibre.org/maplibre-style-spec/).

Visit the [Vector Map Style Profiler website](https://01100100.github.io/mapStyleProfile) to test the load and render times of [MapLibre styles](https://maplibre.org/maplibre-style-spec/) in your browser.

Bring your own style, paste the url into the tool and observe the measured time it takes to load and render the map.

Code for the site is located in the `site/src/index.html` file.

### External Resources

The website relies on [MapLibre GL](https://github.com/maplibre/maplibre-gl-js), included via a CDN link, to render maps.

## Automated browser testing

The `src/main.py` Python script automates browser testing across multiple styles using [Playwright](https://playwright.dev/python/docs/intro). It captures load times, takes screenshots, and outputs results to `timing_results.json`.

### Docker

The Vector Map Style Profiler can be run in a Docker container. A Dockerfile is included in the repository. To build the Docker image, run the following command:

```bash
docker build -t map-style-profiler .
```

To run the Docker container with a mounted volume for the outputted files, run the following command:

```bash
docker run -it --rm --ipc=host -v ${PWD}/:/output --env-file=.env map-style-profiler
```

## Results website

There is a site that has a graph on to compare the results of profiling the different styles can be compared.

The site uses `echarts` to visualize the `timing_results.json` file that is generated by the automated browser testing script. 

The typescript in `src/index.ts` is compiled and the bundle is injected into the `results.html` file using webpack.

### Serving the site locally

```bash
cd site/
npm install
npm run serve
```

*Note: The site uses the `timing_results.json` file generated by the automated browser testing script. Make sure to run the automated browser testing script before serving the site locally.*

### Building and deploying with Github Actions

The project uses Github Actions to:

- Run the automated browser testing script
- Build the results site
- Deploy the site to using [Github Pages](https://pages.github.com/) 

The workflow is defined in the `.github/workflows` directory.

Y**ou can access the results by visiting the following URL:** [https://01100100.github.io/mapStyleProfile/results](https://01100100.github.io/mapStyleProfile/results).

## Contributions

Contributions to the Vector Map Style Profiler project are greatly appreciated. If you find any issues or have suggestions for improvements, please feel free to submit a pull request or open an issue.

To add a new style for testing, update the `styles` list in `src/main.py`.

*Note: an API keys is required for some styles. API keys are set as a github repository secret. If you would like to contribute a style from a new provider, please contact me such that I can configure a API key for the new provider.*

## License

This project is licensed under the [Unlicense](https://github.com/01100100/mapStyleProfile/blob/main/LICENSE).
